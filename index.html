<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<html>
<head>
  <title>Quadtree with visible internal nodes</title>
  <link rel="stylesheet" type="text/css" href="quadtreevis.css" />
</head>

<body>

<h2>Quadtree</h2>

<p>
A <a href="http://en.wikipedia.org/wiki/Quadtree">quadtree</a> is a tree in which each node has at most four children. <a href="https://github.com/mbostock/d3/wiki/Quadtree-Geom">D3's quadtree</a> implementation (<a href="https://github.com/mbostock/d3/blob/master/src/geom/quadtree.js">source</a>) is for storing points in a rectangular space in a way that can be quickly searched. This is a common use case for quadtrees.</p>
<p class="aside">
  A quadtree used to divide up a 2D space is analogous to a <a href="http://en.wikipedia.org/wiki/Binary_tree">binary tree</a> dividing a 1D space (a line). If you have random points on a line, you can arrange points in a binary tree in such a way that the two children of the root node each represent halves of the line, and the grandchildren each represent quarters of the line, and so forth. So, when you search for a given point on the line, rather than examining every point on the line, you can simply walk down the tree.
</p>
<p>In the D3 quadtree, each node is either a leaf or a non-leaf.</p>
<ul>
  <li>Each leaf stores information describing a point: x and y values.</li>
  <li>Each non-leaf represents a quadrant, a sub-rectangle within the space, and has children, which are either leaves (points) or other non-leaves (quadrants).</li>
</ul>
<p>
When a new point is inserted, the D3 quadtree <a href="https://github.com/mbostock/d3/blob/master/src/geom/quadtree.js#L101">decides which quadrant</a> of the root node that the point should be in (by checking the point's x and y against the horiontal center and vertical centers of the node's quad). If there is a leaf node (let's call it N) in that quadrant, <a href="https://github.com/mbostock/d3/blob/master/src/geom/quadtree.js#L84">it moves N's point into a child of N</a> and adds the new point as a child of N as well. N <a href="https://github.com/mbostock/d3/blob/master/src/geom/quadtree.js#L108">becomes a non-leaf</a> when it gets children.

</p>
<p>
I put this together to better understand how a quadtree rearranges itself to accommodate points that are added to it. <a href="https://github.com/jimkang/quadtreevis">The source is here.</a>

<p class="instructions">Hit <strong>N, space, enter, or the down arrow</strong> to add a point with a random position to the quadtree.</p>

<svg id="quadboard" width="49%" height="65%">
  <g id="quadroot"></g>
  <g id="pointroot"></g>
</svg>

<svg id="treeboard" width="49%" height="65%">
  <g id="treelayer"></g>
</svg>

<p class="instructions">The left panel will update to display the territory covered by the quadtree nodes. The right panel will show the quadtree's internal node tree. You can <strong>drag</strong> to pan around the panel and use the <strong>mouse wheel</strong> to zoom.</p>

<script src="lib/d3.v3.js"></script>
<script src="uid.js"></script>
<script src="node_modules/svgcamera/camera.js"></script>
<script src="node_modules/strokerouter/strokerouter.js"></script>
<script src="nodestree.js"></script>
<script src="transparentquadtree.js"></script>
<script type="text/javascript" src="quadtree_exercise.js"></script>

<script type="text/javascript">
var exercise = createQuadtreeExercise();
// console.log(quadtree.nodes);

</script>

</body>
</html>
